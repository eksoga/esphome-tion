substitutions:
  ## Name of the node. Don't use underscores!
  ## https://esphome.io/guides/faq.html#why-shouldn-t-i-use-underscores-in-my-device-name
  node_name: test-o2-uart-api
  
  ## Name for the main entity and prefix for all others.
  friendly_name: $node_name

  ## UART configuration.
  ## !!! Make sure to use YOUR pins or remove if you are using board specific package.
  tx_pin: GPIO19
  rx_pin: GPIO20

  ## WiFi settings.
  wifi_ssid: !secret wifi_ssid
  wifi_password: !secret wifi_password
  ## WiFi Access Point password.
  wifi_ap_password: tion-0123-o2
  project_source: ../../components

  project_source_refresh: 0s

packages:
  common/wifi_signal: !include ../../packages/common/wifi_signal.yaml
  common/uptime: !include ../../packages/common/uptime.yaml
  common/restart: !include ../../packages/common/restart.yaml
  common/esp32_temperature: !include ../../packages/common/esp32_temperature.yaml
  common/web_server: !include ../../packages/common/web_server.yaml
  # tion/temperature30c: !include ../../packages/tion/temperature30c.yaml
  tion/energy: !include ../../packages/tion/energy.yaml
  tion/enable_antifreeze: !include ../../packages/tion/enable_antifreeze.yaml
  base: !include ../../packages/base.yaml
  esp32_s3_uart: !include ../../packages/esp32_s3_uart.yaml
  tion/auto_co2: !include ../../packages/tion/auto_co2.yaml
  tion/auto_co2_config: !include ../../packages/tion/auto_co2_config.yaml
  # mqtt: !include ../../packages/mqtt.yaml
  # spruthub: !include ../../packages/spruthub.yaml
  # board/lilygo: !include ../../packages/board/lilygo.yaml
  # board/seeed_c6: !include ../../packages/board/seeed_c6.yaml
  # debug: !include ../../packages/debug.yaml
  tion/o2: !include ../../packages/tion/o2.yaml

## Uncomment to enable MQTT connection and remove api section.
## Do not forget to uncomment mqtt.yaml or if you plan to use SprutHub spruthub.yaml package above.
# mqtt:
#    broker: !secret mqtt_broker
#    port: !secret mqtt_port
#   username: !secret mqtt_username
#   password: !secret mqtt_password

## Enable Home Assistant API connection.
## It is strongly recommended to remove if you use MQTT!!!
api:
  ## Uncomment next line if you do not use Home Assistant.
  #reboot_timeout: 0s

## WiFi access point configuration.
wifi:
  ## Comment next 2 lines to enable manual WiFi configuration via access point.
  ssid: $wifi_ssid
  password: $wifi_password
  ## Comment next 2 lines to set access point without password.
  ap:
    password: $wifi_ap_password
  ## To completely remove access point remove previous two lines and uncomment next one.
  #ap: !remove

## Virtual port configuration.
vport:
  - platform: tion_o2_uart
    id: tion_uart_vport
    uart_id: tion_uart
    ## Optional, Interval between sending commands. Set to 0ms to send one command per loop.
    # command_interval: 20ms
    ## Optional, Command queue size. Default: 10.
    # command_queue_size: 16

## Main climate component configuration.
## See detailed description and additional parameters at CONFIGURATION.md
tion:
  type: o2
  id: tion_api
  ## Optional, use vport_id with multiple breezers.
  vport_id: tion_uart_vport
  ## Optional, How often query device state. Default: 60s.
  update_interval: 30s
  ## Optional, Timeout to combine update operations. Default: 200ms.
  batch_timeout: 200ms
  ## Optional, Timeout to enable state problem sensor. Must be less than update_interval. Default: 3s.
  state_timeout: 3s
  ## Optional, Updates sensor values on any state response or only if they have been changed. Default: false.
  force_update: false
  ## Optional, Periodically saves current state and restores it of power loss. Default: false.
  restore_state: true
  ## Uncomment to enable automatic co2 fan speed management.
  ## Also required uncommented tion/auto_co2.yaml and tion/auto_co2_config.yaml.
  ## Please find example of co2 sensor by searching co2_value in this file.
  auto:
    co2: co2_value # this is not an id from HA but id from your sensor in this config

  ## Optional, Enable presets. Default: <empty> (no presets)
  ## You can define any number of presets with any name.
  ## In Home assistant climate entity presets with names home, away, boost, comfort,
  ## eco, sleep and activity are automatically translated to your native language and assign icons.
  ## Preset configuration:
  ##  name_of_your_preset:
  ##    fan_speed: 1            # remove or set to 0 to use current state
  ##    temperature: 16         # remove or set to 0 to use current state
  ##    heater: False           # remove to use current state
  ##    power: True             #
  ## Uncomment next 4 lines to enable example presets.
  # presets:
  #   home: { fan_speed: 2, temperature: 16, heater: False }
  #   away: { fan_speed: 1, temperature: 10, heater: False }
  #   sleep: { fan_speed: 1, temperature: 18 }

################################################################################
##
## Next sections set are only example configuration.
##
## In most cases it is enough, but if you prefer to customize please refer to
## CONFIGURATION.md for full set of available entities and options.
##
################################################################################

## Main control entity.
climate:
  - platform: tion
    id: tion_climate
    name: Climate
    ## Add HEAT_COOL mode to support turn_on without touching current heater mode.
    enable_heat_cool: True
    ## Add addition "Automatic" fan mode. Affected only if auto enabled.
    enable_fan_auto: True

## Example of control with a fan entity. More info at CONFIGURATION.md.
#fan:
#  - platform: tion
#    id: tion_climate
#    name: Fan

sensor:
  ## Temperature of air before heater, °C (celsius).
  - platform: tion
    id: tion_outdoor_temperature
    type: outdoor_temperature
    name: Outdoor Temperature
  ## Current productivity, m³/h (cubic meters per hour).
  - platform: tion
    id: tion_productivity
    type: productivity
    name: Productivity
  ## Filter time left counter.
  - platform: tion
    id: tion_filter_time_left_days
    type: filter_time_left_days
    name: Filter Time Left
  ## Boost time left sensor.
  - platform: tion
    id: tion_boost_time_left
    type: boost_time_left
    name: Boost Time Left
  ## Example of sensor from Home Assistant.
  #- platform: homeassistant
  #  id: co2_value
  #  entity_id: sensor.bedroom_air_monitor_co2
  ## Example of sensor from MQTT broker.
  #- platform: mqtt_subscribe
  #  id: co2_value
  #  topic: the/topic
  ## Example of fake co2 constant value sensor.
  - platform: template
    id: co2_value
    lambda: return 800;
  ## Additional test-only entities
  - { platform: tion, name: None, type: fan_speed }
  - { platform: tion, name: None, type: current_temperature }
  - { platform: tion, name: None, type: target_temperature }
  - { platform: tion, name: None, type: power }
  - { platform: tion, name: None, type: heater_var }
  - { platform: tion, name: None, type: fan_power }
  - { platform: tion, name: None, type: airflow }
  - { platform: tion, name: None, type: filter_time_left }
  - { platform: tion, name: None, type: work_time }
  - { platform: tion, name: None, type: work_time_days }
  - { platform: tion, name: None, type: fan_time }
  - { platform: tion, name: None, type: fan_time_days }
  - { platform: tion, name: None, type: airflow_counter }
  - { platform: tion, name: None, type: pcb_ctl_temperature }
  - { platform: tion, name: None, type: pcb_pwr_temperature }

switch:
  ## Boost/Turbo switch.
  - platform: tion
    id: tion_boost
    type: boost
    name: Boost
    ## Optional, Heater state when boost enabled. If not set current state will be used.
    #heater: False
    ## Optional, Target heater temperature state when boost enabled.
    ##           If not set or set to 0 - current target temperature will be used.
    #temperature: 10
  ## Additional test-only entities
  - { platform: tion, name: None, type: power }
  - { platform: tion, name: None, type: heater }
  - { platform: tion, name: None, type: auto }

number:
  ## Configure boost time.
  - platform: tion
    id: tion_boost_time
    type: boost_time
    name: Boost Time
    initial_value: 20min
    restore_value: true
  ## Additional test-only entities
  - { platform: tion, name: None, type: fan_speed }
  - { platform: tion, name: None, type: target_temperature }
  ## Additional test-only entities
select:
  - { platform: tion, name: None, type: air_intake }
  - { platform: tion, name: None, type: presets }
  - { platform: tion, name: None, type: fan_speed }

binary_sensor:
  ## Informs about state receiving problem from the breezer.
  - platform: tion
    id: tion_state_problem
    type: state
    name: State Problem
  ## Filter warning state.
  - platform: tion
    id: tion_filter_worn_out
    type: filter
    name: Filter Worn Out
  ## Additional test-only entities
  - { platform: tion, name: None, type: power }
  - { platform: tion, name: None, type: heater }
  - { platform: tion, name: None, type: heating }
  - { platform: tion, name: None, type: sound }
  - { platform: tion, name: None, type: led }
  - { platform: tion, name: None, type: gate_error }
  - { platform: tion, name: None, type: error }
  - { platform: tion, name: None, type: boost }

text_sensor:
  ## Tion firmware version.
  - platform: tion
    id: tion_firmware_version
    type: firmware_version
    name: Version
  ## Reports Tion's errors (EC) and warnings (WS).
  ## Full error/warning description you can find in a log.
  - platform: tion
    id: tion_errors
    type: errors
    name: Errors
  ## Additional test-only entities
  - { platform: tion, name: None, type: hardware_version }

  ## Additional test-only entities
fan:
  - { platform: tion, name: None }
